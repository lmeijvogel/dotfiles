#!/usr/bin/env ruby

$LOAD_PATH << File.dirname(__FILE__)

require '_create_shell_variables'

LOCAL_PREFIX_REGEX  = %r|^refs/heads/|
REMOTE_PREFIX_REGEX = %r|^refs/remotes/origin/|

def lines
  all_refs = `git for-each-ref --format '%(refname)'`.each_line.map(&:strip)

  local_branches  = all_refs.grep LOCAL_PREFIX_REGEX
  remote_branches = all_refs.grep REMOTE_PREFIX_REGEX

  local_basenames  = local_branches.map  { |branch| branch.gsub(LOCAL_PREFIX_REGEX, "") }
  remote_basenames = remote_branches.map { |branch| branch.gsub(REMOTE_PREFIX_REGEX, "") }

  local_basenames - remote_basenames
end

CreateShellVariables.new.perform(lines)
